%% Load julia-simulated data
simdata = readtable("simdata.csv");

%% True Covariance
S  = [   4.9224   -0.0639    0.6477
        -0.0639    0.0978   -0.1626
         0.6477   -0.1626    1.2883];

%% Normal bayesian model
NormMdl = bayesvarm(3,2,'SeriesNames',simdata.Properties.VariableNames, ...
        'ModelType','normal', ...
        'Center',0.9, ...
        'SelfLag',100, ...
        'CrossLag',1, ...
        'Decay',2, ...
        'VarianceX',100, ...
        'Sigma',S);
NormEstMdl = estimate(NormMdl, simdata{:,:});

NormStruct = struct;
NormStruct.Prior.Phi.Mu = NormMdl.Mu;
NormStruct.Prior.Phi.V = NormMdl.V;
Nor
NormStruct.Post.Phi.Mu = NormEstMdl.Mu;
NormStruct.Post.Phi.V = NormEstMdl.V;
NormStruct.Post.Sigma.Psi = NormEstMdl.Covariance;

%% Conjugate bayesian model
MNIWMdl = bayesvarm(3,2,'SeriesNames',simdata.Properties.VariableNames, ...
        'ModelType','conjugate', ...
        'Center',0.9, ...
        'SelfLag',100, ...
        'CrossLag',1, ...
        'Decay',2, ...
        'VarianceX',100);
MNIWEstMdl = estimate(MNIWMdl, simdata{:,:});

MNIWStruct = struct;
MNIWStruct.Phi.Mu = MNIWEstMdl.Mu;
MNIWStruct.Phi.V = MNIWEstMdl.V;
MNIWStruct.Sigma.nu = MNIWEstMdl.DoF;
MNIWStruct.Sigma.Psi = MNIWEstMdl.Omega;

%% Semi-conjugate bayesian model
GibbsMdl = bayesvarm(3,2,'SeriesNames',simdata.Properties.VariableNames, ...
        'ModelType','semiconjugate', ...
        'Center',0.9, ...
        'SelfLag',100, ...
        'CrossLag',1, ...
        'Decay',2, ...
        'VarianceX',100);
GibbsEstMdl = estimate(GibbsMdl, simdata{:,:});

GibbsStruct = struct;
GibbsStruct.Phi = GibbsEstMdl.CoeffDraws;
GibbsStruct.Sigma = GibbsEstMdl.SigmaDraws;

%% Save results to struct
out = struct('Normal',NormStruct,'MNIW',MNIWStruct,'Gibbs',GibbsStruct);
save('matlab_output.mat', '-struct', 'out');